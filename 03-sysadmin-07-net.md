
# Домашнее задание к занятию «Компьютерные сети. Лекция 2»

### Цель задания

В результате выполнения задания вы:

* познакомитесь с инструментами настройки сети в Linux, агрегации нескольких сетевых интерфейсов, отладки их работы;
* примените знания о сетевых адресах на практике для проектирования сети.


### Инструкция к заданию

1. Создайте .md-файл для ответов на вопросы задания в своём репозитории, после выполнения прикрепите ссылку на него в личном кабинете.
2. Любые вопросы по выполнению заданий задавайте в чате учебной группы или в разделе «Вопросы по заданию» в личном кабинете.


### Дополнительные материалы для выполнения задания

1. [Онлайн-калькулятор сетей](https://calculator.net/ip-subnet-calculator.html).
2. Калькулятор сетей — программа ipcalc (`apt install ipcalc`). Если есть графический интерфейс, то у программы-калькулятора есть инженерный режим, там можно считать и сети.

------

## Задание

1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

**Решение:**

В Windows команда `ipconfig /all` отобразит список всех доступных сетевых адаптеров с адресами.

В Linux подобный список выводит команда `ip a`, а если без ip-адресов `ip l`. Также можно использовать утилиту `ifconfig`.

2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

**Решение:**

Протокол LLDP. Пакет `lldpd` и команда `lldpcli show neighbors` или `lldpctl`.

3. Какая технология используется для разделения L2-коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

**Решение:**

Для разделения на несколько виртуальных сетей используется технология VLAN.
Для управления VLAN на Linux CentOS 7 можно использовать команду `vconfig` или создать конфиг для нового Vlan.
Список сетевых интерфейсов, включая VLAN8 для сетевого интерфейса `eth1`:

```bash
[root@centos7test network-scripts]# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:15:5d:05:2e:35 brd ff:ff:ff:ff:ff:ff
    inet 192.168.5.236/24 brd 192.168.5.255 scope global noprefixroute eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::215:5dff:fe05:2e35/64 scope link
       valid_lft forever preferred_lft forever
3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:15:5d:05:2e:41 brd ff:ff:ff:ff:ff:ff
    inet 192.168.100.53/24 brd 192.168.100.255 scope global noprefixroute eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::215:5dff:fe05:2e41/64 scope link
       valid_lft forever preferred_lft forever
4: eth1.8@eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:15:5d:05:2e:41 brd ff:ff:ff:ff:ff:ff
    inet 192.168.8.53/24 brd 192.168.8.255 scope global noprefixroute eth1.8
       valid_lft forever preferred_lft forever
    inet6 fe80::215:5dff:fe05:2e41/64 scope link
       valid_lft forever preferred_lft forever
 ```   
 
 Конфигурационный файл vlan: 
 ```bash
[root@centos7test ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth1.8
#vlan8
DEVICE=eth1.8
BOOTPROTO=none
ONBOOT=yes
IPADDR=192.168.8.53
NETMASK=255.255.255.0
USERCTL=no
NETWORK=192.168.8.0
VLAN=yes
```


4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

**Решение:**

Типы агрегации интерфейсов в Linux:

Mode-0(balance-rr) – Данный режим используется по умолчанию. Balance-rr обеспечивается балансировку нагрузки и отказоустойчивость. В данном режиме сетевые пакеты отправляются "по кругу", от первого интерфейса к последнему. Если выходят из строя интерфейсы, пакеты отправляются на остальные оставшиеся. Дополнительной настройки коммутатора не требуется при нахождении портов в одном коммутаторе. При разностных коммутаторах требуется дополнительная настройка.

Mode-1(active-backup) – Один из интерфейсов работает в активном режиме, остальные в ожидающем. При обнаружении проблемы на активном интерфейсе производится переключение на ожидающий интерфейс. Не требуется поддержки от коммутатора.

Mode-2(balance-xor) – Передача пакетов распределяется по типу входящего и исходящего трафика по формуле ((MAC src) XOR (MAC dest)) % число интерфейсов. Режим дает балансировку нагрузки и отказоустойчивость. Не требуется дополнительной настройки коммутатора/коммутаторов.

Mode-3(broadcast) – Происходит передача во все объединенные интерфейсы, тем самым обеспечивая отказоустойчивость. Рекомендуется только для использования MULTICAST трафика.

Mode-4(802.3ad) – динамическое объединение одинаковых портов. В данном режиме можно значительно увеличить пропускную способность входящего так и исходящего трафика. Для данного режима необходима поддержка и настройка коммутатора/коммутаторов.

Mode-5(balance-tlb) – Адаптивная балансировки нагрузки трафика. Входящий трафик получается только активным интерфейсом, исходящий распределяется в зависимости от текущей загрузки канала каждого интерфейса. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.

Mode-6(balance-alb) – Адаптивная балансировка нагрузки. Отличается более совершенным алгоритмом балансировки нагрузки чем Mode-5). Обеспечивается балансировку нагрузки как исходящего так и входящего трафика. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.

Для балансировки нагрузки есть опции: balance-rr, balance-xor, balance-tlb, balance-alb.

```bash
[root@netology ~]# cat /proc/net/bonding/bond0
Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)

Bonding Mode: load balancing (round-robin)
MII Status: up
MII Polling Interval (ms): 1
Up Delay (ms): 1
Down Delay (ms): 10

Slave Interface: eth0
MII Status: up
Speed: 10000 Mbps
Duplex: full
Link Failure Count: 0
Permanent HW addr: 00:15:5d:d0:0e:0c
Slave queue ID: 0

Slave Interface: eth1
MII Status: up
Speed: 10000 Mbps
Duplex: full
Link Failure Count: 0
Permanent HW addr: 00:15:5d:d0:0e:0d
Slave queue ID: 0

[root@netology ~]# nmcli device status
DEVICE  TYPE      STATE           CONNECTION
bond0   bond      подключено      bond0
eth0    ethernet  подключено      bond-slave-eth0
eth1    ethernet  подключено      bond-slave-eth1
lo      loopback  без управления  --
```

5. Сколько IP-адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

**Решение:**

В сети с маской /29 может быть 6 хостов и 1 широковещательный адрес и 1 адрес сети:
```bash
ivan@ubuntutest:~$ ipcalc 10.10.10.0/29
Address:   10.10.10.0           00001010.00001010.00001010.00000 000
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   10.10.10.0/29        00001010.00001010.00001010.00000 000
HostMin:   10.10.10.1           00001010.00001010.00001010.00000 001
HostMax:   10.10.10.6           00001010.00001010.00001010.00000 110
Broadcast: 10.10.10.7           00001010.00001010.00001010.00000 111
Hosts/Net: 6                     Class A, Private Internet
```
В сети с маской /24 может быть 254 хоста и 1 широковещательный адрес и 1 адрес сети:

```bash
ivan@ubuntutest:~$ ipcalc 10.10.10.0/24
Address:   10.10.10.0           00001010.00001010.00001010. 00000000
Netmask:   255.255.255.0 = 24   11111111.11111111.11111111. 00000000
Wildcard:  0.0.0.255            00000000.00000000.00000000. 11111111
=>
Network:   10.10.10.0/24        00001010.00001010.00001010. 00000000
HostMin:   10.10.10.1           00001010.00001010.00001010. 00000001
HostMax:   10.10.10.254         00001010.00001010.00001010. 11111110
Broadcast: 10.10.10.255         00001010.00001010.00001010. 11111111
Hosts/Net: 254                   Class A, Private Internet
```

Общее количество адресов в подсети /24 будет 256, а в подсети /29 их 8. Делим 256 на 8 и получаем 32 подсети /29. Или можно установить расширенный калькулятор сети `sipcalc`, который покажет на какие подсети будет деление:

```bash
ivan@ubuntutest:~$ sudo  sipcalc -s /29 10.10.10.0/24
-[ipv4 : 10.10.10.0/24] - 0

[Split network]
Network                 - 10.10.10.0      - 10.10.10.7
Network                 - 10.10.10.8      - 10.10.10.15
Network                 - 10.10.10.16     - 10.10.10.23
Network                 - 10.10.10.24     - 10.10.10.31
Network                 - 10.10.10.32     - 10.10.10.39
Network                 - 10.10.10.40     - 10.10.10.47
Network                 - 10.10.10.48     - 10.10.10.55
Network                 - 10.10.10.56     - 10.10.10.63
Network                 - 10.10.10.64     - 10.10.10.71
Network                 - 10.10.10.72     - 10.10.10.79
Network                 - 10.10.10.80     - 10.10.10.87
Network                 - 10.10.10.88     - 10.10.10.95
Network                 - 10.10.10.96     - 10.10.10.103
Network                 - 10.10.10.104    - 10.10.10.111
Network                 - 10.10.10.112    - 10.10.10.119
Network                 - 10.10.10.120    - 10.10.10.127
Network                 - 10.10.10.128    - 10.10.10.135
Network                 - 10.10.10.136    - 10.10.10.143
Network                 - 10.10.10.144    - 10.10.10.151
Network                 - 10.10.10.152    - 10.10.10.159
Network                 - 10.10.10.160    - 10.10.10.167
Network                 - 10.10.10.168    - 10.10.10.175
Network                 - 10.10.10.176    - 10.10.10.183
Network                 - 10.10.10.184    - 10.10.10.191
Network                 - 10.10.10.192    - 10.10.10.199
Network                 - 10.10.10.200    - 10.10.10.207
Network                 - 10.10.10.208    - 10.10.10.215
Network                 - 10.10.10.216    - 10.10.10.223
Network                 - 10.10.10.224    - 10.10.10.231
Network                 - 10.10.10.232    - 10.10.10.239
Network                 - 10.10.10.240    - 10.10.10.247
Network                 - 10.10.10.248    - 10.10.10.255
```

6. Задача: вас попросили организовать стык между двумя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP-адреса? Маску выберите из расчёта — максимум 40–50 хостов внутри подсети.

**Решение:**

Адреса можно взять из сети 100.64.0.0 — 100.127.255.255 (маска подсети 255.192.0.0 или /10). Этот диапазон также определен IANA как частные адреса. 
Подсчитаю через `ipcalc`:

```bash
ivan@ubuntutest:~$ ipcalc 100.64.0.0/10 -s 50
Address:   100.64.0.0           01100100.01 000000.00000000.00000000
Netmask:   255.192.0.0 = 10     11111111.11 000000.00000000.00000000
Wildcard:  0.63.255.255         00000000.00 111111.11111111.11111111
=>
Network:   100.64.0.0/10        01100100.01 000000.00000000.00000000
HostMin:   100.64.0.1           01100100.01 000000.00000000.00000001
HostMax:   100.127.255.254      01100100.01 111111.11111111.11111110
Broadcast: 100.127.255.255      01100100.01 111111.11111111.11111111
Hosts/Net: 4194302               Class A

1. Requested size: 50 hosts
Netmask:   255.255.255.224 = 27 11111111.11111111.11111111.111 00000
Network:   100.64.0.0/27        01100100.01000000.00000000.000 00000
HostMin:   100.64.0.1           01100100.01000000.00000000.000 00001
HostMax:   100.64.0.30          01100100.01000000.00000000.000 11110
Broadcast: 100.64.0.31          01100100.01000000.00000000.000 11111
Hosts/Net: 30                    Class A

Needed size:  64 addresses.
Used network: 100.64.0.0/26
Unused:
100.64.0.64/26
100.64.0.128/25
100.64.1.0/24
100.64.2.0/23
100.64.4.0/22
100.64.8.0/21
100.64.16.0/20
100.64.32.0/19
100.64.64.0/18
100.64.128.0/17
100.65.0.0/16
100.66.0.0/15
100.68.0.0/14
100.72.0.0/13
100.80.0.0/12
100.96.0.0/11
```

Поэтому будет использоваться подсеть 100.64.0.0/26, которая может содержать до 64 адреса.

7. Как проверить ARP-таблицу в Linux, Windows? Как очистить ARP-кеш полностью? Как из ARP-таблицы удалить только один нужный IP?

**Решение:**

В Windows:
Команда для просмотра ARP таблицы:
`arp -a`
Команда для очистки ARP кеша полностью:
`arp -d *`
Команда для очистки ARP кеша нужного inet_addr:
`arp -d inet_addr`

В Linux:
Команда для просмотра ARP таблицы:
`arp -a` или `arp -n` (CentOS), или `ip neigh` (CentOS, Ubuntu)

Команда для очистки ARP кеша полностью:
`ip neigh flush all`

Команда для очистки ARP кеша нужного inet_addr:
`arp -d inet_addr` (CentOS) или `ip neigh flush inet_addr` (CentOS, Ubuntu)

*В качестве решения отправьте ответы на вопросы и опишите, как они были получены.*

---

## Задание со звёздочкой* 

Это самостоятельное задание, его выполнение необязательно.

 8. Установите эмулятор EVE-ng.
 
[Инструкция по установке](https://github.com/svmyasnikov/eve-ng).

Выполните задания на lldp, vlan, bonding в эмуляторе EVE-ng. 
 
----

### Правила приёма домашнего задания

В личном кабинете отправлена ссылка на .md-файл в вашем репозитории.


### Критерии оценки

Зачёт:

* выполнены все задания;
* ответы даны в развёрнутой форме;
* приложены соответствующие скриншоты и файлы проекта;
* в выполненных заданиях нет противоречий и нарушения логики.

На доработку:

* задание выполнено частично или не выполнено вообще;
* в логике выполнения заданий есть противоречия и существенные недостатки.  
 
Обязательными являются задачи без звёздочки. Их выполнение необходимо для получения зачёта и диплома о профессиональной переподготовке.

Задачи со звёздочкой (*) являются дополнительными или задачами повышенной сложности. Они необязательные, но их выполнение поможет лучше разобраться в теме.
